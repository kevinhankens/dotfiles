From f76ccdcfe45ae22827844a3cbd41f5c18130d53d Mon Sep 17 00:00:00 2001
From: James Elliott <james.elliott@acquia.com>
Date: Wed, 18 May 2011 13:39:15 -0400
Subject: [PATCH 2/2] form_builder_pre_render is run after drupal_pre_render_markup so that the markup preview alter needs to also change the #children value.

---
 .../webform/form_builder_webform.components.inc    |    4 ++++
 1 files changed, 4 insertions(+), 0 deletions(-)

diff --git a/modules/webform/form_builder_webform.components.inc b/modules/webform/form_builder_webform.components.inc
index b9ad09b..8c1dfce 100644
--- a/modules/webform/form_builder_webform.components.inc
+++ b/modules/webform/form_builder_webform.components.inc
@@ -425,6 +425,10 @@ function _form_builder_webform_form_builder_preview_alter_markup($form_element)
     $form_element['#markup'] = t('Empty markup field');
   }
 
+  // This runs after drupal_pre_render_markup so the changed markup 
+  // needs to be copied to #children.
+  $form_element['#children'] = $form_element['#markup'];
+
   // Do not show the title, since it will not display in the final webform
   // either.
   $form_element['#title_display'] = 'none';
-- 
1.7.4.msysgit.0

